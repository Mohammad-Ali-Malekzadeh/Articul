""" Persian description --------------------------- Floating Point Arithmetic: Issues and Limitations ------ P
! ูุญุงุณุจู ุงุนุฏุงุฏ ุงุนุดุงุฑ - ูุณุงุฆู ู ูุญุฏูุฏุช ูุง

ุฏุฑ ุณุฎุช ุงูุฒุงุฑ ฺฉุงููพูุชุฑ ุจุตูุฑุช ุฏู ุฏู ุง ุจุงูุฑ ูุญุงุณุจู ู ุดููุฏ Floating-point numbers

? decimal fraction: ฺฉุณุฑ ุฏู ุฏู
ุฏุฑ ุณุณุชู ุฏู ุฏู ุงุนุฏุงุฏ ุงุนุดุงุฑ ุจู ุงู ุตูุฑุช ุงุฑุฒุด ุจูุฏ ูุดููุฏ
0.625 = 6/10 + 2/100 + 5/1000    <-------------------------]
.                                                          |
? binary fraction: ฺฉุณุฑ ุจุงูุฑ - ุฏู ุฏู                   |
ุฏุฑ ุณุณุชู ุฏูุฏู ูู ุจู ุงู ุตูุฑุช                           |
0.101 = 1/2 + 0/4 + 1/8 = 0.625                            |
  |||                                                      |
  |||                                                      |
  |||                                                      |
  |||___ 1 * 2 ^ -3 = 0.125 --]                            |
  ||                                                       |
  ||___ 0 * 2 ^ -2 = 0      --|----> 0.125 + 0 + 0.5 = 0.625 (ุจุฑ ูพุงู ุฏู - decimal)
  |
  |___ 1 * 2 ^ -1 = 0.5     --]
ูพุงู 10 ู ุฏูู ุฏุฑ ูพุงู 2 ููุดุชู ุดุฏู ุงุณุช (fractional notation) ุงู ุฏู ฺฉุณุฑ ููุงุฏุฑ ฺฉุณุงู ุฏุงุฑูุฏุ ุชููุง ุชูุงูุช ูุงูุน ุงู ุงุณุช ฺฉู ุงูู ุจุง ููุงุฏ ฺฉุณุฑ
 
ูุดฺฉู ูุญุงุณุจู ุฏุฑ ุงุนุฏุงุฏ ุงุนุดุงุฑ ุฏุฑ ูพุงู 10 ุฎู ูุงุจู ููู ุชุฑ ุงุณุช
ฺฉุณุฑ 1/3 ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ู ุจุฎูุงูู ุจุง ูพุงู 10 ุชูุฑุจ ุจุฒูู
ูุดู:
0.3
ุจูุชุฑุด ฺฉูู
0.33
ุง ุจูุชุฑ:
0.333
ูุชุฌู ูุฑฺฏุฒ ุฏููุงู 1/3 ูุฎูุงูุฏ ุจูุฏ ู ุจู ุขู ูุชููู ูุฒุฏฺฉ ุดู

ุฏุฑ ูพุงู 2 ฺฉุณุฑ 1/10 ุจ ููุงุช ุชฺฉุฑุงุฑ ู ุจุงุดุฏ.
0.0001100110011001100110011001100110011001100110011...

! approximate binary fraction
ุฏุฑ ุจุดุชุฑ ูุงุดู ูุง ุงูุฑูุฒ ุงุนุฏุงุฏ ุงุนุดุงุฑ ุจุง ฺฉูฺฉ ุฑูุด ุฒุฑ ุชุฎูู ุฒุฏู ูุดู:
ูพูุฌุงู ู ุณู ุจุช ฺฉู ุงุฒ ููู ุชุฑู ุจุช ุดุฑูุน ูุดูุฏ ู ูุฎุฑุฌ ุขู ุจู ุชูุงู 2 ูุฑุณุฏbinary fraction ุฏุฑ ุตูุฑุช ฺฉุณุฑ 

ู true decimal value ุฑู ุจู ุนููุงู decimal ุฎู ุงุฒ ฺฉุงุฑุจุฑูุง ุจู ุฎุงุทุฑ ูุญูู ููุงุด ููุงุฏุฑ ุงุฒ ุชูุฑุจ ุฎุจุฑ ุฏุงุฑ ูุณุชูุฏ ู ูพุงุชูู ุชูุฑุจ
ุชูุฑุจ ุจุงูุฑ ุฐุฎุฑู ุดุฏู ุฏุฑ ูุงุดู ุฑุง ูุดุงู ูุฏูุฏ

ุฐุฎุฑู ุดุฏู ุจุฑุง 0.1 ูุดุงู ุฏูุฏ ุฏุงุฑู true decimal value of the binary approximation ุงฺฏุฑ ูพุงุชูู ุจุฎูุงูุฏ :
>>> 0.1
0.1000000000000000055511151231257827021181583404541015625

ุจูุงุจุฑ ุงู ฺูู ุจุดุชุฑ ุงุนุฏุงุฏ ุจุฑุง ฺฉุงุฑุจุฑุงู ฺฉุงุฑุจุฑุฏ ูุฏุงุฑุฏุ ูพุงุชูู ุจู ุฌุงุด ุฑูุฏ ุดุฏุด ุฑู ูุดูู ูุฏู.
ุฑุง ุจู ูู ุฏุงุฑูุฏ approximate binary fraction ุฌุงูุจ ุงูุฌุงุณุช ฺฉู ุงุนุฏุงุฏ ุงุนุดุงุฑ ูุฎุชูู ุฒุงุฏ ูุฌูุฏ ุฏุงุฑูุฏ ฺฉู ูุฒุฏฺฉุชุฑู 
ูุงููุฏ ูุซุงู ูุง ุฒุฑ:
0.1
0.10000000000000001
0.1000000000000000055511151231257827021181583404541015625
ฺฉู ููู ๐ ูุง ุฑุง  ุจุง 3602879701896397 / 2 ** 55 ุชูุฑุจ ุฒุฏู ูุดู
"""

print("------------ 1st Example ------------")
print("any one of them could be displayed while still preserving the invariant")
x = 0.10000000000000001
y = 0.10000000000000099
print(eval(repr(x)) == x)
print(x)
print(y)

""" 
ูุงุฏ ู 17 ุชุง ุงุฒ ููู ุชุฑู ุงุนุฏุงุฏ ุงูุชุฎุงุจ ูฺฉูู repr() ู built-in ุงุฒ ูุญุงุธ ุชุงุฑุฎ  ุชุงุจุน
ุงุฒ ุฒูุงู ฺฉู ูพุงุชูู 3 ุงููุฏ ฺฉูุชุงู ุชุฑู ุนุฏุฏ ุฑู ุจุฑูุฏุงุฑู ู 0.1 ุฎูุฏ ุจู ุฎูุฏ ุจู ุฌุง 0.100000000000001 ูุดูู ูุฏู

ุณุฎุชโุงูุฒุงุฑ ุดูุง ูพุดุชุจุงู ูโฺฉููุฏุ ฺุฒูุง ูุดุงุจู ุฎูุงูุฏ ุฏุฏ ู ฺฉ ุจุงฺฏ ุฏุฑ ูพุงุชูู ูุณุชfloating-point arithmetic ุฏุฑ ููู ุฒุจุงูโูุง ฺฉู ุงุฒ

ุจุฑุง ุฎุฑูุฌ ุฏููพุฐุฑ ุชุฑุ  ููฺฉู ุงุณุช ุจุฎูุงูุฏ ุงุฒ ุฑุดุชู ูุง ุจุฑุง ุชููุฏ ุชุนุฏุงุฏ ูุญุฏูุฏ ุงุฑูุงู ูุงุจู ุชูุฌู ู ููู ุงุณุชูุงุฏู ฺฉูุฏ
"""

print("------------ 2nd Example ------------")
import math

print(format(math.pi, ".12g"))  # give 12 significant digits
print(format(math.pi, ".2f"))  # give 2 digits after the point
# ูุจูู ฺฉู ุชุงุจุน ุฒุฑ 17 ุชุง ุนุฏุฏ ุจุฑูฺฏุฑุฏููู
print(repr(math.pi))

""" 
ุฑุง ฺฏุฑุฏ ูฺฉูุฏ display of the true machine value ูฺฉุชู ููู ุงูุฌุงุณุช ฺฉู ฺฉูุง ุงู ูุณุนูู ฺฉ ุชููู ุงุณุช ู ุดูุง ุจู ุณุงุฏฺฏ
ุง ุชููู ูุชูุงูุฏ ุชููู ูุง ุฏฺฏุฑ ุงุฌุงุฏ ฺฉูุฏ illusion ฺฉ 
ุงุฒ ุขูุฌุง ฺฉู 0.1 ุฏููุง ุจุฑุงุจุฑ 1/10 ูุณุชุ ุฌูุน ฺฉุฑุฏู 3 ุชุง 0.1 ุฏููุง ุจุฑุงุจุฑ 0.3 ูู ุจุงุดุฏ
"""

print("------------ 3th Example ------------")
print(0.1 + 0.1 + 0.1 == 0.3)

""" 
? pre-rounding  
ูู ฺฉูฺฉ ุจุฑุง ุญู ุงู ูุณุนูู ููฺฉูุฏ round() ููฺูู ุงุฒ ุขูุฌุง ฺฉู 0.1 ููุชูุงูุฏ ุจู 1/10 ู 0.3 ุจู 3/10 ูุฒุฏฺฉ ุชุฑ ุดูุฏ ูพุณ ูพุด-ฺฏุฑุฏ ฺฉุฑุฏู ุจุง ุชุงุจุน
"""

print("------------ 4th Example ------------")
print(round(0.1, 1) + round(0.1, 1) + round(0.1, 1) == round(0.3, 1))

""" 
? post-rounding
ุจุฑุง ูพุณ-ฺฏุฑุฏ ฺฉุฑุฏู ุฑุงู ุญู ููุงุณุจ ูุณุช round() ุชุงุจุน 
ุจู ุทูุฑ ฺฉู ูุชุงุฌ ุจุง ููุงุฏุฑ ุบุฑ ุฏูู ุจุง ฺฉุฏฺฏุฑ ูุงุจู ููุงุณู ุจุงุดูุฏ
"""

print("------------ 5th Example ------------")
print(round(0.1 + 0.1 + 0.1) == round(0.3))

""" 
ุงุณุชูุงุฏู ฺฉุฑุฏ decimal ุจุฑุง ูุญุงุณุจู ุฏูู ุงุนุฏุงุฏ ุงุนุดุงุฑ ููฺฏุงู ุจุฑูุงูู ูุง ุญุณุงุจ ุฏุงุฑ ู ุจุฑูุงูู ูุง ฺฉุงุฑุจุฑุฏ ุจุง ุฏูุช ุจุงูุง ูุชูุงู ุงุฒ ูุงฺูู
ุงุณุชูุงุฏู ฺฉุฑุฏ ุฒุฑุง ูุญุงุณุจุงุช ุฑู ุจุฑ ุงุณุงุณ ุงุนุฏุงุฏ ฺฏูุง ุงุฌุฑุง ูฺฉูุฏ fractions ุง ูุชูุงู ุงุฒ ูุงฺูู
ุชูุณุนู ุฏุงุฏู ูุดู ุงุณุชูุงุฏู ฺฉูุฏ SciPy ู ูพฺฉุฌ ูุง ุฏฺฏุฑ ฺฉู ุชูุณุท ูพุฑูฺู Numpy ูุณุชุฏ ุจุงุฏ ุงุฒ floating point operations ุงฺฏุฑ ฺฉุงุฑุจุฑ ุฏุงุฆู 
? float.as_integer_ratio()
ุจุฏุงูุฏ ฺฉูฺฉ ูฺฉูุฏ exact value of a float ูพุงุชูู ุงุจุฒุงุฑูุง ุฑุง ุงุฑุงุฆู ู ุฏูุฏ ฺฉู ููฺฉู ุงุณุช ุฏุฑ ููุงุฑุฏ ูุงุฏุฑ ฺฉู ูุงูุนุงู ู ุฎูุงูุฏ
ุจุฑูฺฏุฑุฏุงูุฏ fraction ุฑูุจู ุนููุงู float ุงู ุชุงุจุน ููุฏุงุฑ ฺฉ

"""
print("------------ 6th Example ------------")
x1 = 3.14159
print(x.as_integer_ratio())

""" 
ุงุฒ ุขูุฌุง ฺฉู ูุณุจุช ุฏูู ุงุณุชุ ู ุชูุงู ุงุฒ ุขู ุจุฑุง ุจุงุฒุขูุฑู ุจุฏูู ุถุฑุฑ ููุฏุงุฑ ุงุตู ุงุณุชูุงุฏู ฺฉุฑุฏ:
"""

print("------------ 7th Example ------------")
print(x1 == 3537115888337719 / 1125899906842624)

""" 
ุฏุฑ ูพุงู ูฺฏุฒุงุฏุณูุงู (ูพุงู 16) ุจุงู ู ฺฉูุฏุ ฺฉู ุฏูุจุงุฑู ููุฏุงุฑ ุฏูู ุฐุฎุฑู ุดุฏู ุชูุณุท ุฑุงุงูู ุดูุง ุฑุง ูุดุงู ู ุฏูุฏ float ฺฉ 
"""

print("------------ 8th Example ------------")
print(x1.hex())

""" 
ุงุณุชูุงุฏู ฺฉุฑุฏ value exactly ุฏูู ุฑุง ูุชูุงู ุจุฑุง ุจุงุฒุณุงุฒ hexadecimal ุงู ููุงุด
"""

print("------------ 9th Example ------------")
print(x1 == float.fromhex("0x1.921f9f01b866ep+1"))

""" 
ุงุฒ ุขูุฌุง ฺฉู ููุงุด ุฏูู ุงุณุชุ ุจุฑุง ุงูุชูุงู ูุทูุฆู ููุงุฏุฑ ุฏุฑ ูุณุฎูโูุง ูุฎุชูู ูพุงุชูู (ุงุณุชููุงู ูพูุชูุฑู) ู ุชุจุงุฏู ุฏุงุฏู ุจุง
ุฒุจุงูโูุง ุฏฺฏุฑ ฺฉู ุงุฒ ูุฑูุช ฺฉุณุงู ูพุดุชุจุงู ูโฺฉููุฏ (ูุงููุฏ ุฌุงูุง) ููุฏ ุงุณุช

ู(ุงูุช ุฏูุช) ุฏุฑ ุญู ุฌูุน ฺฉุฑุฏู ฺฉุงูุด ูพุฏุง ฺฉูู loss-of-precision ฺฉูฺฉ ูฺฉูุฏ ุชุง math.fsum() ุชุงุจุน 
ู(ุงุฑูุงู ฺฏู ุดุฏู) ุฏุฑ ุนููุงุช ุฌูุน ฺฉุฑุฏู ุงุถุงูู ูุดูุฏ. ุจู ุทูุฑ ฺฉู ุฎุทุงูุง ุชุง ุฌุง ุฌูุน ููุดููุฏ ฺฉู ุจุฑ ฺฉู ููุง ุชุงุซุฑ ฺฏุฐุงุฑ ุจุงุดุฏ lost digits
"""

print("------------ 10th Example ------------")
print(sum([0.1] * 10) == 1.0)
print(math.fsum([0.1] * 10) == 1.0)

""" 
? Representation Error
ุฏุฑ ุจุดุชุฑ ฺฉุณุฑ ูุง ุฏููุง ุจุง ุจุงูุฑ ููุงุด ุฏุงุฏู ููุดูุฏdecimal fractions ู(ุฎุทุง ููุงุด) ุจู ุงู ูุงูุนุช ุงุดุงุฑู ุฏุงุฑู ฺฉู Representation error
ฺุฑุง 1/10 ุฏููุงู ุจู ุนููุงู ฺฉ ฺฉุณุฑ ุจุงูุฑ ูุงุจู ููุงุด ูุณุชุ
ุงุณุชูุงุฏู ูโฺฉููุฏ IEEE-754 ุชูุฑุจุงู ููู ูุงุดูโูุง ุงูุฑูุฒ (ููุงูุจุฑ 2000) ุงุฒ ูุญุงุณุจุงุช ููุฒ ุดูุงูุฑ 
ุงุณุชูุงุฏู ูฺฉูุฏ IEEE-754 โdouble precisionโ ูพุงุชูู
ุดุงูู 53 ุจุช ุฏูุช ุงุณุช.
J/2**N ุจูุงุจุฑุงู ุฏุฑ ูุฑูุฏ ฺฉุงููพูุชุฑ ุชูุงุด ูฺฉูุฏ ุชุง 0.1 ุฑุง ุจู ูุฒุฏฺฉุชุฑู ฺฉุณุฑ ุชุจุฏู ฺฉูุฏ ฺฉู ูุชูุงูุฏ ุจู ุงู ุดฺฉู ุจุงุดุฏ IEEE-754 doubles
ฺฉ ุนุฏุฏ ุตุญุญ ุญุงู 53 ุจุช ุงุณุช J ฺฉู ุฏุฑ ุขู
ุจุงุฒููุณ
1 / 10 ~= J / (2**N)
ุฎูุงูุฏ ุจูุฏ
J ~= 2**N / 10

ุจุฑุงุจุฑ 53 ุฏููุง ุจุช ุฎูุงูุฏ ุจูุฏ J ูุฏุงูู ฺฉู 
ุฑุง ุทูุฑ ูพุฏุง ฺฉูู N ู ุจุงุดุฏ ุจุงุฏ (>= 2**52 but < 2**53) ฺฉู ุฏุฑ ุจุงุฒู J ุจุฑุงุจุฑ ุนุฏุฏ 53 ูุณุช. ุจุฑุง ูุญุงุณุจู J ูฺฉุชู ุฌุงูุจ ุงูุฌุงุณุช ฺฉู ููู ูุณุช 
ุฑุง ุฏููุง 53 ุจุช ุจฺฏุฐุงุฑุฏJ ฺฉู 
ุงู ุงุณุช ฺฉู ฺฏุฑุฏ ุดูุฏ J ุจูุชุฑู ููุฏุงุฑ ููฺฉู ุจุฑุง
ุฏุฑ ุงู ูุซุงู56 ุงุณุช N ุจูุชุฑู ููุฏุงุฑ
"""

print("------------ 11th Example ------------")
print(2**52 <= 2**56 // 10 < 2**53)
q, r = divmod(2**56, 10)
print(r)

"""
ุจุง ฺฏุฑุฏ ฺฉุฑุฏู ุจู ุฏุณุช ู ุขุฏ approximation  ุงุฒ ุขูุฌุง ฺฉู ุจุงู ูุงูุฏู ุจุด ุงุฒ ูู ุงุฒ 10 ุงุณุชุ ุจูุชุฑู ุชูุฑุจ
"""

print("------------ 12th Example ------------")
print(q + 1)

""" 
754 double precision ุฏุฑ approximation ุจูุงุจุฑ ุงู ุจูุชุฑู ุชูุฑุจ
ุฎูุงูุฏ ุจูุฏ:
"""

print("------------ 13th Example ------------")
print(7205759403792794 / 2 ** 56)
print(3602879701896397 / 2 ** 55)

""" 
ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุงุฒ ุขูุฌุง ฺฉู ูุง ฺฏุฑุฏ ฺฉุฑุฏูุ ุงู ููุฏุงุฑ ุฏุฑ ูุงูุน ฺฉู ุจุฒุฑฺฏุชุฑ ุงุฒ 1/10 ุงุณุช
ุงฺฏุฑ ุจู ุจุงูุง ฺฏุฑุฏ ูู ฺฉุฑุฏูุ ุถุฑุจ ฺฉู ฺฉูฺฺฉุชุฑ ุงุฒ 1/10 ุจูุฏ. ุงูุง ุฏุฑ ูฺ ููุฑุฏ ูู ุชูุงูุฏ ุฏููุง 1/10 ุจุงุดุฏ 

ฺฉุณุฑ ุฏูู) ุงุณุช ฺฉู ุฏุฑ ุจุงูุง ุฏุงุฏู ุดุฏู ุงุณุช ) exact fraction ูพุณ ูฺ ููุช ฺฉุงููพูุชุฑ 1/10 ุฑุง ูู ุจูุฏ. ุขูฺู ูโุจูุฏ
754 double approximation ุจูุชุฑู
ูุชูุงู ุงุฒ ุฑูุด ุฒุฑ ุจุฏุณุช ุขูุฑุฏ.

0.1 = J / 2**55 => J = 0.1 * 2 ** 55
"""

print("------------ 14th Example ------------")
print(0.1 * 2 ** 55)

"""
ุงฺฏุฑ ุขู ฺฉุณุฑ ุฑุง ุฏุฑ 10**55 ุถุฑุจ ฺฉููุ ู ุชูุงูู ููุฏุงุฑ ุขู ุฑุง ุชุง 55 ุฑูู ุงุนุดุงุฑ ุจุจูู:

"""

print("------------ 15th Example ------------")
print(3602879701896397 * 10 ** 55 // 2 ** 55)

"""
ุจู ุงู ูุนู ฺฉู ุนุฏุฏ ุฏูู ุฐุฎุฑู ุดุฏู ุฏุฑ ฺฉุงููพูุชุฑ ุจุฑุงุจุฑ ุจุง ููุฏุงุฑ ุงุนุดุงุฑ 0.100000000000000055511151231257827021181583404541015625 ุงุณุช. ุจู ุฌุง ููุงุด ููุฏุงุฑ ุงุนุดุงุฑ ฺฉุงููุ ุจุณุงุฑ ุงุฒ ุฒุจุงู ูุง (ุงุฒ ุฌููู ูุณุฎู ูุง ูุฏู ูพุงุชูู)ุ ูุชุฌู ุฑุง ุจู 17 ุฑูู ูุงุจู ุชูุฌู ฺฏุฑุฏ ู ฺฉููุฏ
"""

print("------------ 16th Example ------------")
print(format(0.1, '.17f'))

from decimal import Decimal
from fractions import Fraction

print(Fraction.from_float(0.1))
print((0.1).as_integer_ratio())
print(Decimal.from_float(0.1))
print(format(Decimal.from_float(0.1), '.17'))